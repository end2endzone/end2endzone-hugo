<table {{- range $k, $v := .Attributes }}
    {{- if $v }} {{ printf "%s=%q" $k $v | safeHTMLAttr }}{{ end }}
  {{- end }} >

  {{/* Grab header and body slices */}}
  {{- $thead := .THead -}}
  {{- $tbody := .TBody -}}

  {{/* scan each header cell for non-empty text */}}
  {{ $hasHeaderRowContent := false }}
  {{ range $row := .THead }}
    {{ range $cell := $row }}
      {{ $trimmed := trim $cell.Text " " }}
      {{ if ne $trimmed "" }}
        {{ $hasHeaderRowContent = true }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{/* Only emit <thead> when thereâ€™s at least one header row */}}
  {{ if and (gt (len $thead) 0) ($hasHeaderRowContent) }}
    <thead>
      {{ range $thead }}
        <tr>
          {{ range . }}
            <th {{ with .Alignment }} style="text-align: {{ . }};" {{ end }} >
              {{ .Text }}
            </th>
          {{ end }}
        </tr>
      {{ end }}
    </thead>
  {{ end }}

  <tbody>
    {{ range $tbody }}
      <tr>
        {{ range . }}
          <td {{ with .Alignment }} style="text-align: {{ . }};" {{ end }} >
            {{ .Text }}
          </td>
        {{ end }}
      </tr>
    {{ end }}
  </tbody>
</table>
